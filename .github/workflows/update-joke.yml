# ================================================================
#  GitHub Actions Workflow: Update Joke in README
# ================================================================
#  ðŸ”¹ This workflow automatically updates the **Joke of the Day**  
#     section in `README.md` with a random joke from `jokes.json`.
#
#  âœ… Runs **daily at 12:00 AM UTC** to refresh the joke.
#  âœ… Can be manually triggered from the GitHub Actions UI.
#  
#  ðŸ“Œ Steps:
#  1ï¸âƒ£ Checks out the repository.
#  2ï¸âƒ£ Picks a **random joke** from `jokes.json`.
#  3ï¸âƒ£ Updates the **Joke of the Day** section in `README.md`.
#  4ï¸âƒ£ Commits and pushes the updated README.md file.
#
#  ðŸš€ No personal access token (PAT) required! Uses `GITHUB_TOKEN`.
# ================================================================

name: Update Joke in README

on:
  schedule:
    - cron: "0 0 * * *"  # âœ… Runs **daily at 12:00 AM UTC**
  workflow_dispatch:       # âœ… Allows manual trigger

jobs:
  update-readme:
    runs-on: ubuntu-latest
    permissions: write-all  # âœ… Required to push updates

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4  # âœ… Clones the repository

      - name: Select a Random Joke
        id: joke_picker
        run: |
          # âœ… Picks a random joke from `jokes.json`
          JOKE=$(jq -r '.[]' jokes.json | shuf -n 1)

          # âœ… Store the joke in GitHub Actions environment
          echo "JOKE=$JOKE" >> $GITHUB_ENV

      - name: Update README.md
        run: |
          # âœ… Replaces the section between JOKE markers with the new joke
          sed -i '/<!-- JOKE-SECTION-START -->/,/<!-- JOKE-SECTION-END -->/c\<!-- JOKE-SECTION-START -->\n**ðŸ˜‚ Joke of the Day:**\n> '"$JOKE"'\n<!-- JOKE-SECTION-END -->' README.md

      - name: Commit & Push Changes
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # âœ… Uses GitHub token for authentication
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "actions@github.com"
          
          git add README.md
          git commit -m "Updated Joke of the Day ðŸ˜‚" || exit 0
          git push origin main
